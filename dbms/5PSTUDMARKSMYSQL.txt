CREATE DATABASE IF NOT EXISTS school;
USE school;

-- Drop old tables if they exist
DROP TABLE IF EXISTS Result;
DROP TABLE IF EXISTS Stud_Marks;

-- Create tables
CREATE TABLE Stud_Marks (
    Roll INT PRIMARY KEY AUTO_INCREMENT,
    Name VARCHAR(50),
    Total_Marks INT
);

CREATE TABLE Result (
    Roll INT,
    Name VARCHAR(50),
    Class VARCHAR(30)
);


INSERT INTO Stud_Marks (Name, Total_Marks) VALUES
('Om Gawande', 1200),
('Raj Mehta', 950),
('Neha Sharma', 870),
('Aditi Patil', 820),
('Vikas Rao', 760);


DELIMITER $$

CREATE PROCEDURE proc_Grade()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE v_roll INT;
    DECLARE v_name VARCHAR(50);
    DECLARE v_marks INT;
    DECLARE v_class VARCHAR(30);

    -- Cursor to read all students
    DECLARE cur_stud CURSOR FOR SELECT Roll, Name, Total_Marks FROM Stud_Marks;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    OPEN cur_stud;

    read_loop: LOOP
        FETCH cur_stud INTO v_roll, v_name, v_marks;
        IF done = 1 THEN
            LEAVE read_loop;
        END IF;

        -- Categorize the student based on marks
        IF v_marks BETWEEN 990 AND 1500 THEN
            SET v_class = 'Distinction';
        ELSEIF v_marks BETWEEN 900 AND 989 THEN
            SET v_class = 'First Class';
        ELSEIF v_marks BETWEEN 825 AND 899 THEN
            SET v_class = 'Higher Second Class';
        ELSE
            SET v_class = 'Fail';
        END IF;

        -- Insert the result into Result table
        INSERT INTO Result (Roll, Name, Class)
        VALUES (v_roll, v_name, v_class);
    END LOOP;

    CLOSE cur_stud;
END$$

DELIMITER ;


CALL proc_Grade();


SELECT * FROM Result;
