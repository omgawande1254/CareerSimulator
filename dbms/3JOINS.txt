-- ======================================================
-- SQL PRACTICAL: Joins, Subqueries, and Views
-- ======================================================

-- 1ï¸âƒ£ Create Database
CREATE DATABASE CollegeDB;
USE CollegeDB;

-- 2ï¸âƒ£ Create Tables
CREATE TABLE Departments (
    DeptID INT PRIMARY KEY,
    DeptName VARCHAR(50)
);

CREATE TABLE Students (
    StudentID INT PRIMARY KEY,
    StudentName VARCHAR(50),
    DeptID INT,
    Age INT,
    FOREIGN KEY (DeptID) REFERENCES Departments(DeptID)
);

CREATE TABLE Courses (
    CourseID INT PRIMARY KEY,
    CourseName VARCHAR(50),
    DeptID INT,
    FOREIGN KEY (DeptID) REFERENCES Departments(DeptID)
);

CREATE TABLE Enrollments (
    StudentID INT,
    CourseID INT,
    Marks INT,
    FOREIGN KEY (StudentID) REFERENCES Students(StudentID),
    FOREIGN KEY (CourseID) REFERENCES Courses(CourseID)
);

-- 3ï¸âƒ£ Insert Data
INSERT INTO Departments VALUES
(1, 'Computer Science'),
(2, 'Mechanical'),
(3, 'Civil');

INSERT INTO Students VALUES
(101, 'Rahul', 1, 21),
(102, 'Priya', 1, 20),
(103, 'Amit', 2, 22),
(104, 'Sneha', 3, 23);

INSERT INTO Courses VALUES
(501, 'DBMS', 1),
(502, 'Thermodynamics', 2),
(503, 'Structures', 3),
(504, 'AI', 1);

INSERT INTO Enrollments VALUES
(101, 501, 85),
(101, 504, 90),
(102, 501, 80),
(103, 502, 75),
(104, 503, 88);

-- ======================================================
-- ðŸ”¹ SQL DML QUERIES using Joins, Subqueries & Views
-- ======================================================

-- 1. INNER JOIN: Show students with their enrolled courses
SELECT s.StudentName, c.CourseName
FROM Students s
INNER JOIN Enrollments e ON s.StudentID = e.StudentID
INNER JOIN Courses c ON e.CourseID = c.CourseID;

-- 2. LEFT JOIN: List all students and their enrolled courses
SELECT s.StudentName, c.CourseName
FROM Students s
LEFT JOIN Enrollments e ON s.StudentID = e.StudentID
LEFT JOIN Courses c ON e.CourseID = c.CourseID;

-- 3. RIGHT JOIN: List all courses and enrolled students
SELECT s.StudentName, c.CourseName
FROM Students s
RIGHT JOIN Enrollments e ON s.StudentID = e.StudentID
RIGHT JOIN Courses c ON e.CourseID = c.CourseID;

-- 4. FULL OUTER JOIN (using UNION)
SELECT s.StudentName, c.CourseName
FROM Students s
LEFT JOIN Enrollments e ON s.StudentID = e.StudentID
LEFT JOIN Courses c ON e.CourseID = c.CourseID
UNION
SELECT s.StudentName, c.CourseName
FROM Students s
RIGHT JOIN Enrollments e ON s.StudentID = e.StudentID
RIGHT JOIN Courses c ON e.CourseID = c.CourseID;

-- 5. CROSS JOIN: Display all possible combinations of students and courses
SELECT s.StudentName, c.CourseName
FROM Students s
CROSS JOIN Courses c;

-- 6. SUBQUERY (Single Row): Students with marks > average marks
SELECT StudentID, CourseID, Marks
FROM Enrollments
WHERE Marks > (SELECT AVG(Marks) FROM Enrollments);

-- 7. SUBQUERY (Multiple Row using IN): Students enrolled in Computer Science courses
SELECT StudentName
FROM Students
WHERE StudentID IN (
    SELECT e.StudentID
    FROM Enrollments e
    JOIN Courses c ON e.CourseID = c.CourseID
    WHERE c.DeptID = 1
);

-- 8. CORRELATED SUBQUERY: Students scoring above average in their course
SELECT s.StudentName, e.Marks
FROM Students s
JOIN Enrollments e ON s.StudentID = e.StudentID
WHERE e.Marks > (
    SELECT AVG(Marks)
    FROM Enrollments e2
    WHERE e2.CourseID = e.CourseID
);

-- 9. VIEW CREATION: View showing student names with course and marks
CREATE VIEW StudentCourseView AS
SELECT s.StudentName, c.CourseName, e.Marks
FROM Students s
JOIN Enrollments e ON s.StudentID = e.StudentID
JOIN Courses c ON e.CourseID = c.CourseID;

-- 10. QUERY USING VIEW: Students scoring above 85
SELECT * FROM StudentCourseView
WHERE Marks > 85;
