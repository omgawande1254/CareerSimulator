CREATE TABLE Library (
    Book_ID NUMBER PRIMARY KEY,
    Book_Name VARCHAR2(100),
    Author VARCHAR2(100),
    Price NUMBER
);

CREATE TABLE Library_Audit (
    Audit_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    Book_ID NUMBER,
    Book_Name VARCHAR2(100),
    Author VARCHAR2(100),
    Price NUMBER,
    Action_Type VARCHAR2(20),
    Action_Date DATE
);


INSERT INTO Library VALUES (1, 'DBMS Concepts', 'Korth', 550);
INSERT INTO Library VALUES (2, 'Let Us C', 'Yashwant Kanetkar', 350);
INSERT INTO Library VALUES (3, 'Operating Systems', 'Silberschatz', 600);
COMMIT;


CREATE OR REPLACE TRIGGER trg_Library_Audit
BEFORE UPDATE OR DELETE ON Library
FOR EACH ROW
BEGIN
    IF UPDATING THEN
        INSERT INTO Library_Audit (Book_ID, Book_Name, Author, Price, Action_Type, Action_Date)
        VALUES (:OLD.Book_ID, :OLD.Book_Name, :OLD.Author, :OLD.Price, 'UPDATE', SYSDATE);
    ELSIF DELETING THEN
        INSERT INTO Library_Audit (Book_ID, Book_Name, Author, Price, Action_Type, Action_Date)
        VALUES (:OLD.Book_ID, :OLD.Book_Name, :OLD.Author, :OLD.Price, 'DELETE', SYSDATE);
    END IF;
END;
/


UPDATE Library SET Price = 700 WHERE Book_ID = 3;


DELETE FROM Library WHERE Book_ID = 2;


SELECT * FROM Library_Audit;
